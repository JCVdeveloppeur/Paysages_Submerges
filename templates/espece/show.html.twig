{# templates/espece/show.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Fiche esp√®ce - {{ espece.nomCommun }}{% endblock %}

{# M√™me fond d√©grad√© que la fiche maladie #}
{% block body_class %}degrade-aquatique-body{% endblock %}

{% block body %}
<div class="container my-5 fiche-espece">

    <a href="{{ path('espece_public_index') }}" class="btn btn-retour btn-sm mb-4">
        ‚Üê Retour √† la liste des esp√®ces
    </a>

    <div class="espece-carnet">
                {# HEADER #}
        <header class="espece-carnet__header text-center">
            <h1 class="espece-carnet__title">
                {{ espece.nomCommun }}
            </h1>

            {% if espece.nomScientifique %}
                <div class="espece-nom-scientifique fst-italic">
                    {{ espece.nomScientifique }}
                </div>
            {% endif %}

            <div class="espece-badges mt-2">

                {# Badge TYPE (vert, "Poisson", "Mollusque", etc.) #}
                {% set t = (espece.typeEspece ?? '')|lower|trim %}
                {% set typeClass =
                t starts with 'poisson' ? 'type--poisson' :
                (t starts with 'mollus' ? 'type--mollusque' :
                (t starts with 'crust' ? 'type--crustace' : 'type--na'))
                %}

                {% if t %}
                <span class="badge-type {{ typeClass }}">
                    {{ t|capitalize }}
                </span>
                {% else %}
                ‚Äî
                {% endif %}

                {# Badge BIOTOPE harmonis√© avec les articles #}
                {% if espece.biotope %}
                    {% set b = espece.biotope|lower %}

                    {# On d√©duit une "cat√©gorie article" √† partir du texte du biotope #}
                    {% set biotopeCategorie =
                        'am√©rique' in b ? 'Biotope Am√©rique du sud' :
                        ('asie'      in b ? 'Biotope asiatique'      :
                        ('afrique'   in b ? 'Biotope africain'       :
                        ('austral'   in b ? 'Biotope australien'     : 'Autre')))
                    %}

                    {% set badgeClass = {
                        'Biotope Am√©rique du sud': 'badge-amerique-sud',
                        'Biotope asiatique':        'badge-asiatique',
                        'Biotope africain':         'badge-africain',
                        'Biotope australien':       'badge-australien',
                        'Autre':                    'badge-autre'
                    }[biotopeCategorie] ?? 'badge-autre' %}

                    <span class="badge {{ badgeClass }}">
                        {% if biotopeCategorie == 'Biotope Am√©rique du sud' %}üå±
                        {% elseif biotopeCategorie == 'Biotope asiatique' %}üåä
                        {% elseif biotopeCategorie == 'Biotope africain' %}üèúÔ∏è
                        {% elseif biotopeCategorie == 'Biotope australien' %}ü™∏
                        {% else %}üåç
                        {% endif %}
                        {{ biotopeCategorie }}
                    </span>
                {% endif %}
            </div>
        </header>

        {# IMAGE PRINCIPALE + L√âGENDE #}
        {% if espece.imageName %}
        <figure class="fiche-espece__figure carnet-image">
            <img src="{{ asset('uploads/especes/' ~ espece.imageName) }}"
                alt="{{ espece.nomCommun }}"
                class="fiche-espece__image">

            <figcaption class="fiche-espece__caption">
            {{ espece.nomCommun }} dans son habitat naturel
            </figcaption>
        </figure>
        {% endif %}

                {# LAYOUT 2 COLONNES, COMME POUR LA FICHE MALADIE #}
                <div class="row espece-layout">
                    <div class="col-lg-8">
                        {# DESCRIPTION PHYSIQUE #}
                        {% if espece.descriptionPhysique %}
                            <section class="fiche-section">
                                <h2 class="fiche-titre">
                                    <span class="fiche-icone fiche-icone-physique">
                                        üêü
                                    </span>
                                    Description
                                </h2>
                                <div class="fiche-texte">
                                    {{ espece.descriptionPhysique|nl2br }}
                                </div>
                            </section>
                        {% endif %}

                        {# COMPORTEMENT #}
                        {% if espece.comportement %}
                            <section class="fiche-section">
                                <h2 class="fiche-titre">
                                    <span class="fiche-icone fiche-icone-comportement">
                                        üß≠
                                    </span>
                                    Comportement
                                </h2>
                                <div class="fiche-texte">
                                    {{ espece.comportement|nl2br }}
                                </div>
                            </section>
                        {% endif %}

                        {# ALIMENTATION #}
                        {% if espece.alimentation %}
                            <section class="fiche-section">
                                <h2 class="fiche-titre">
                                    <span class="fiche-icone fiche-icone-alimentation">
                                        üçΩÔ∏è
                                    </span>
                                    Alimentation
                                </h2>
                                <div class="fiche-texte">
                                    {{ espece.alimentation|nl2br }}
                                </div>
                            </section>
                        {% endif %}

                        {# REPRODUCTION #}
                        {% if espece.reproduction %}
                            <section class="fiche-section">
                                <h2 class="fiche-titre">
                                    <span class="fiche-icone fiche-icone-reproduction">
                                        üß¨
                                    </span>
                                    Reproduction
                                </h2>
                                <div class="fiche-texte">
                                    {{ espece.reproduction|nl2br }}
                                </div>
                            </section>
                        {% endif %}
                    </div>

                    {# COLONNE DE DROITE : "INFOS RAPIDES" #}
                    <aside class="col-lg-4">
                        <section class="espece-meta-card">
                            <h2 class="espece-meta-titre">Infos rapides</h2>

                            <dl class="espece-meta-liste">
                                <div class="espece-meta-item">
                                    <dt>Biotope</dt>
                                    <dd>{{ espece.biotope ?? 'N/A' }}</dd>
                                </div>

                                <div class="espece-meta-item">
                                    <dt>Taille bac</dt>
                                    <dd>{{ espece.tailleMinimaleBac ?? 'N/A' }} L</dd>
                                </div>

                                <div class="espece-meta-item">
                                    <dt>Dur√©e de vie</dt>
                                    <dd>{{ espece.dureeVie ?? 'N/A' }} ans</dd>
                                </div>

                                <div class="espece-meta-item">
                                    <dt>Temp√©rature</dt>
                                    <dd>{{ espece.temperatureMin ?? 'N/A' }} - {{ espece.temperatureMax ?? 'N/A' }} ¬∞C</dd>
                                </div>

                                <div class="espece-meta-item">
                                    <dt>pH</dt>
                                    <dd>{{ espece.phMin ?? 'N/A' }} - {{ espece.phMax ?? 'N/A' }}</dd>
                                </div>

                                <div class="espece-meta-item">
                                    <dt>GH</dt>
                                    <dd>{{ espece.ghMin ?? 'N/A' }} - {{ espece.ghMax ?? 'N/A' }}</dd>
                                </div>

                                <div class="espece-meta-item">
                                    <dt>Type</dt>
                                    <dd>{{ espece.typeEspece ?? 'N/A' }}</dd>
                                </div>
                            </dl>

                            {# √Ä RETENIR √Ä L‚ÄôINT√âRIEUR DE LA CARTE #}
                            <div class="espece-meta-retour">
                                <div class="espece-meta-retour__titre">√Ä retenir</div>
                                <div class="espece-meta-retour__texte">
                                    Esp√®ce : {{ espece.nomCommun }}.
                                    <br>
                                    Respectez les param√®tres d'eau et pr√©voyez un bac adapt√©.
                                </div>
                            </div>
                        </section>
                    </aside>

                </div>  {# <-- fermeture de .row espece-layout #}

                {# FOOTER : RETOUR + BOUTONS ADMIN #}
                <footer class="espece-carnet__footer mt-4 d-flex justify-content-between align-items-center flex-wrap gap-2">
                    {# <a href="{{ path('espece_public_index') }}" class="link-secondary">
                        ‚Üê Retour √† la liste des esp√®ces
                    </a> #}

                    {% if is_granted('ROLE_ADMIN') %}
                        <div class="espece-carnet__actions">
                            <a href="{{ path('espece_edit', {'id': espece.id}) }}" class="btn btn-outline-warning btn-sm me-2">
                                ‚úèÔ∏è Modifier
                            </a>
                            {{ include('espece/_delete_form.html.twig') }}
                        </div>
                    {% endif %}
                </footer>
    </div>
</div>
{% endblock %}







