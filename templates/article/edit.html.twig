{% extends 'base.html.twig' %}

{% block title %}Modifier l'article{% endblock %}

{% block body %}
<div class="container py-5 article-edit">

  <h1 class="mb-4 text-center">Modifier l'article</h1>

  {# Nav d’ancrage #}
  <ul class="nav nav-pills gap-2 form-nav mb-4" role="tablist">
    <li class="nav-item"><a class="nav-link active" href="#sec-meta">Meta</a></li>
    <li class="nav-item"><a class="nav-link" href="#sec-chapeau">Chapeau</a></li>
    <li class="nav-item"><a class="nav-link" href="#sec-contenu">Contenu</a></li>
    <li class="nav-item"><a class="nav-link" href="#sec-pullquote">Pull-quote</a></li>
    <li class="nav-item"><a class="nav-link" href="#sec-images">Images</a></li>
    <li class="nav-item"><a class="nav-link" href="#sec-param">Paramètres</a></li>
  </ul>

  <div class="row justify-content-center">
    <div class="col-lg-10 col-xl-9">

      {{ form_start(form, {'attr': {'enctype': 'multipart/form-data'}}) }}

      {# TITRE #}
      <section id="sec-meta" class="form-section">
        <h2 class="form-section__title">Meta</h2>
        <div class="mb-3">
          {{ form_label(form.titre) }}
          {{ form_widget(form.titre, {'attr': {'class': 'form-control'}}) }}
          {{ form_errors(form.titre) }}
        </div>

        <div class="mb-3">
          {{ form_label(form.categorie) }}
          {{ form_widget(form.categorie, {'attr': {'class': 'form-select'}}) }}
          {{ form_errors(form.categorie) }}
        </div>
      </section>

      {# --- CHAPEAU --- #}
        <section id="sec-chapeau" class="form-section">
        <h2 class="form-section__title">Chapeau</h2>
        {{ form_row(form.chapeau, {
            label: 'Chapeau',
            label_attr: { class: 'visually-hidden' },
            attr: {
            class: 'form-control autogrow',
            rows: 4,
            placeholder: 'Un court résumé accrocheur…'
            },
            help: 'Court texte introductif (affiché sous le titre).'
        }) }}
        </section>

      {# CONTENU #}
        <section id="sec-contenu" class="form-section">
        <h2 id="titre-contenu" class="form-section__title">Contenu</h2>
        {{ form_row(form.contenu, {
            label: 'Contenu',
            label_attr: { class: 'visually-hidden' },
            attr: {
            class: 'form-control autogrow',   # ⟵ important
            rows: 15,
            'aria-labelledby': 'titre-contenu'
            }
        }) }}
        </section>


      {# PULL QUOTE #}
      <section id="sec-pullquote" class="form-section">
        <h2 class="form-section__title">Pull-quote</h2>

        <div data-controller="pullquote" data-content-selector="#{{ form.contenu.vars.id }}">
          {{ form_row(form.pullQuoteTexte, {
            attr: {
                class: 'form-control autogrow',          # ← largeur 100% + auto-resize
                rows: 8,
                'data-pullquote-target':'text',
                'data-action':'input->pullquote#update',
                'aria-describedby': form.pullQuoteTexte.vars.id ~ '_count'
            },
            help: 'Texte de la citation (1000 caractères maximum).'
            }) }}

          <div class="d-flex justify-content-between small text-muted mt-n2 mb-2">
            <span id="{{ form.pullQuoteTexte.vars.id }}_count" data-pullquote-target="charcount">0/1000</span>
            <span data-pullquote-target="indexHelp"></span>
          </div>

          {{ form_row(form.pullQuoteSource, {
            attr: {
                class: 'form-control',
                'data-pullquote-target':'source',
                'data-action':'input->pullquote#update',
                placeholder: 'Auteur / Source (optionnel)'
            }
            }) }}

          <div class="row g-3">
            <div class="col-md-6">
              {{ form_row(form.pullQuotePosition, {
                attr: {'data-pullquote-target':'position','data-action':'change->pullquote#update'}
              }) }}
            </div>
            <div class="col-md-6">
              {{ form_row(form.pullQuoteTheme, {
                attr: {'data-pullquote-target':'theme','data-action':'change->pullquote#update'}
              }) }}
            </div>
          </div>

          {{ form_row(form.pullQuoteIndex, {
            attr: {'data-pullquote-target':'index','data-action':'input->pullquote#update','min':1},
            help: 'Paragraphe après lequel insérer la citation (1 = après le 1er).'
          }) }}

          {# Aperçu #}
          <div class="mt-3" aria-live="polite">
            <div class="pull-quote right" data-pullquote-target="preview" hidden>
              <blockquote><p data-pullquote-target="previewText"></p></blockquote>
              <span class="source" data-pullquote-target="previewSource"></span>
            </div>
          </div>
        </div>
      </section>

      {# IMAGES #}
      <section id="sec-images" class="form-section">
        <h2 class="form-section__title">Images</h2>

        <div class="mb-3">
          {{ form_label(form.image) }}
          {{ form_widget(form.image, {'attr': {'class': 'form-control'}}) }}
          {{ form_errors(form.image) }}
        </div>

        <div class="card card-body mb-3">
          <h3 class="h6 mb-3">Images intégrées dans le texte</h3>

          {{ form_row(form.imageGauche) }}
          {% if article.imageGauche %}
            <div class="form-media-previews">
              <figure class="form-thumb">
                <img src="{{ asset('uploads/articles/' ~ article.imageGauche) }}" alt="">
              </figure>
            </div>
          {% endif %}
          {{ form_row(form.legendeImageGauche) }}

          {{ form_row(form.imageDroite) }}
          {% if article.imageDroite %}
            <div class="form-media-previews">
              <figure class="form-thumb">
                <img src="{{ asset('uploads/articles/' ~ article.imageDroite) }}" alt="">
              </figure>
            </div>
          {% endif %}
          {{ form_row(form.legendeImageDroite) }}
        </div>

        <div class="card card-body">
          <h3 class="h6 mb-3">Image d'en-tête</h3>
          {{ form_row(form.imageHeader) }}
          {% if article.imageHeader %}
            <div class="form-media-previews">
              <figure class="form-thumb form-thumb--wide">
                <img src="{{ asset('uploads/articles/' ~ article.imageHeader) }}" alt="">
              </figure>
            </div>
          {% endif %}
          {{ form_row(form.legendeImageHeader) }}
        </div>
      </section>

      {# PARAMÈTRES #}
      <section id="sec-param" class="form-section">
        <h2 class="form-section__title">Paramètres</h2>

        <div class="mb-3">
          {{ form_label(form.statut) }}
          {{ form_widget(form.statut, {'attr': {'class': 'form-select'}}) }}
          {{ form_errors(form.statut) }}
        </div>

        <div class="mb-3">
          {{ form_label(form.datePublication, 'Date de publication') }}
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-calendar-event"></i></span>
            {{ form_widget(form.datePublication, {'attr': {'class': 'form-control'}}) }}
          </div>
          {{ form_errors(form.datePublication) }}
        </div>

        {% if form.user is defined %}
          <div class="mb-3">
            {{ form_label(form.user, "Auteur de l'article") }}
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-person-circle"></i></span>
              {{ form_widget(form.user, {'attr': {'class': 'form-select'}}) }}
            </div>
            {{ form_errors(form.user) }}
          </div>
        {% endif %}
      </section>

      {# Rendre le reste (token, champs non affichés) #}
      {{ form_rest(form) }}

      {# Actions #}
      <div class="form-actions mt-4">
        <a href="{{ path('app_articles') }}" class="btn btn-outline-secondary">← Retour aux articles</a>
        <button type="submit" class="btn btn-primary">Enregistrer</button>
      </div>

      {{ form_end(form, { render_rest: false }) }}
    </div>
  </div>
</div>
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  {{ encore_entry_script_tags('article_edit') }}
{% endblock %}





